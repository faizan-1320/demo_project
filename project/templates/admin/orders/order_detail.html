{% extends 'admin/dashboard.html' %}
{% block title %}Order Detail{% endblock %}
{% load static %}
{% block content %}
<div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">
        <div class="container-fluid">
            <div class="row mb-2">
                <div class="col-sm-6">
                    <h1>Order Detail</h1>
                </div>
                <div class="col-sm-6">
                    <ol class="breadcrumb float-sm-right">
                        <li class="breadcrumb-item"><a href="{% url 'dashboard' %}">Home</a></li>
                        <li class="breadcrumb-item active">Order Detail</li>
                    </ol>
                </div>
            </div>
        </div><!-- /.container-fluid -->
    </section>

    <!-- Main content -->
    <section class="content">
        <div class="container-fluid">
            <!-- Order Details -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Order #{{ order.id }}</h3>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h5>Customer Details</h5>
                            <p><strong>Email:</strong> {{ order.user.email }}</p>
                            {% if customer_address %}
                                <p><strong>Billing address:</strong> {{ customer_address.billing_address }}</p>
                                <p><strong>Shipping address:</strong> {{ customer_address.shipping_address }}</p>
                            {% else %}
                                <p>No active address found for this customer.</p>
                            {% endif %}
                        </div>

                        <div class="col-md-6">
                            <h5>Order Details</h5>
                            <p><strong>Order ID:</strong> {{ order.order_id }}</p>
                            <p><strong>Status:</strong> {{ order.get_status_display }}</p>
                            <p><strong>Payment Status:</strong> {{ order.get_payment_status_display }}</p>
                            <p><strong>Payment ID:</strong> {% if order.paypal_payment_id  %}{{ order.paypal_payment_id }}{% else %}-{% endif %}</p>
                            <p><strong>Total Amount:</strong> ${{ order.total_amount }}</p>
                            <p><strong>Payment Date:</strong> {{ order.datetime_of_payment }}</p>
                            <p><strong>Shipping Method:</strong> {{ order.get_shipping_method_display }}</p>
                            <p><strong>Payment Method:</strong> {{ order.get_payment_method_display }}</p>
                        </div>
                    </div>

                    <!-- Ordered Products -->
                    <h5>Ordered Products</h5>
                    <table class="table table-bordered table-hover">
                        <thead>
                            <tr>
                                <th>Product Name</th>
                                <th>Quantity</th>
                                <th>Price</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for product in products_in_order %}
                            <tr>
                                <td>{{ product.product.name }}</td>
                                <td>{{ product.quantity }}</td>
                                <td>${{ product.price }}</td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="3">No products found for this order.</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>

                    <!-- Update Status Form -->
                    <h5 class="mt-2">Update Order Status</h5>
                    <form method="post">
                        {% csrf_token %}
                        {{ form.as_p }}
                        <button type="submit" class="btn btn-primary" {% if order.status == 4 %}disabled{% endif %}>Update Status</button>
                        <button type="button" id="cancelButton" class="btn btn-secondary">Cancel</button>
                    </form>
                </div>
            </div>
        </div><!-- /.container-fluid -->
    </section><!-- /.content -->
</div><!-- /.content-wrapper -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function(){
        $('#cancelButton').on('click', function () {
      window.history.back();
    });
    })
</script>
{% endblock content %}

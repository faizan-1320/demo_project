{% extends 'front_end/index.html' %}
{% load static %}
{% block css %}
<style>
    .product-name {
        font-size: 14px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        display: block;
        max-width: 200px;
    }
    .product-thumbnail {
    max-width: 50px; /* Adjust as needed for thumbnail size */
    max-height: 50px; /* Adjust as needed for thumbnail size */
    object-fit: cover; /* Ensures the image covers the thumbnail area without distortion */
    border-radius: 10px; /* Optional: Rounds the corners of the image */
    border: 1px solid #ddd; /* Optional: Adds a border around the thumbnail */
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); /* Optional: Adds a subtle shadow */
}

/* Optional: Add some margin to separate the thumbnail from text */
.product-thumbnail-container {
    margin-right: 10px; /* Adjust space between image and text */
}
</style>
{% endblock %}
{% block content %}

<section id="cart_items">
    <div class="container">
        <div class="breadcrumbs">
            <ol class="breadcrumb">
              <li><a href="{% url 'home' %}">Home</a></li>
              <li class="active">Shopping Cart</li>
            </ol>
        </div>
        <div class="table-responsive cart_info">
            <table class="table table-condensed">
                <thead>
                    <tr class="cart_menu">
                        <td class="image">Item</td>
                        <td class="description"></td>
                        <td class="price">Price</td>
                        <td class="quantity">Quantity</td>
                        <td class="total">Total</td>
                        <td></td>
                    </tr>
                </thead>
                <tbody>
                    {% for item in cart_items %}
                    <tr>
                        <td class="cart_product">
                            <a href="{% url 'product-detail' item.product.id %}">
                                <img src="{{ item.product.product.last.image.url }}" alt="{{ item.product.name }}" class="product-thumbnail">
                            </a>
                        </td>
                        <td class="cart_description">
                            <h4><a href="{% url 'product-detail' item.product.id %}" class="product-name" style="font-size: 14px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; display: block;">{{ item.product.name }}</a></h4>
                            <p>{{ item.product.description }}</p>
                        </td>
                        <td class="cart_price">
                            <p>₹{{ item.product.price }}</p>
                        </td>
                        <td class="cart_quantity">
                            <div class="cart_quantity_button">
                                <a class="cart_quantity_up" href="javascript:void(0);" onclick="updateQuantity('{{ item.product.id }}', 'increase')"> + </a>
                                <input id="quantity-input-{{ item.product.id }}" class="cart_quantity_input" type="text" name="quantity" value="{{ item.quantity }}" autocomplete="off" size="2" readonly>
                                <a class="cart_quantity_down" href="javascript:void(0);" onclick="updateQuantity('{{ item.product.id }}', 'decrease')"> - </a>
                            </div>
                        </td>
                        <td class="cart_total">
                            <p class="cart_total_price">₹{{item.total_price}}</p>
                        </td>
                        <td class="cart_delete">
                            <form action="{% url 'remove-from-cart' item.product.id  %}" method="post">
                            {% csrf_token %}
                            <button type="submit" style="border: none; background: none; cursor: pointer;">
                                <i class="fa fa-times"></i>
                            </button>
                            </form>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="6" class="text-center">Your cart is empty.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</section> <!--/#cart_items-->
{% if cart_items %}
<section id="do_action">
    <div class="container">
        <div class="heading">
            <h3>What would you like to do next?</h3>
            <p>Choose if you have a discount code or reward points you want to use or would like to estimate your delivery cost.</p>
        </div>
        <div class="row">
            <div class="col-sm-6">
                <div class="chose_area">
                    <ul class="user_option">
                        <li>
                            <input type="checkbox">
                            <label>Use Coupon Code</label>
                        </li>
                    </ul>
                    <ul class="user_info">
                        <li class="single_field">
                            <label>Country:</label>
                            <select>
                                <option>United States</option>
                                <option>Bangladesh</option>
                                <option>UK</option>
                                <option>India</option>
                                <option>Pakistan</option>
                                <option>Ukraine</option>
                                <option>Canada</option>
                                <option>Dubai</option>
                            </select>
                            
                        </li>
                        <li class="single_field">
                            <label>Region / State:</label>
                            <select>
                                <option>Select</option>
                                <option>Dhaka</option>
                                <option>London</option>
                                <option>Delhi</option>
                                <option>Lahore</option>
                                <option>Alaska</option>
                                <option>Canada</option>
                                <option>Dubai</option>
                            </select>
                        
                        </li>
                        <li class="single_field zip-field">
                            <label>Zip Code:</label>
                            <input type="text">
                        </li>
                    </ul>
                    <a class="btn btn-default check_out" href="">Continue</a>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="total_area">
                    <ul>
                        <li>Sub Total <span>₹{{ cart_sub_total }}</span></li>
                        <li>Eco Tax <span>₹{{ eco_tax }}</span></li>
                        <li>Shipping Cost <span>{% if shipping_cost == 0 %}Free{% else %}₹{{ shipping_cost }}{% endif %}</span></li>
                        <li>Total <span>₹{{ total }}</span></li>
                    </ul>
                        <a class="btn btn-default update" href="#">Update</a>
                        <a class="btn btn-default check_out" href="#">Check Out</a>
                </div>
            </div>
        </div>
    </div>
</section><!--/#do_action-->
{% endif %}  
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script type="text/javascript">
    function updateQuantity(productId, action) {
        var quantityInput = $("#quantity-input-" + productId);
        var currentQuantity = parseInt(quantityInput.val());
        var newQuantity = currentQuantity;

        if (action === 'increase') {
            newQuantity += 1;
        } else if (action === 'decrease' && currentQuantity > 1) {
            newQuantity -= 1;
        }

        $.ajax({
            url: "{% url 'update-cart-quantity' 0 %}".replace('0', productId),
            type: "POST",
            data: {
                'quantity': newQuantity,
                'csrfmiddlewaretoken': '{{ csrf_token }}',
            },
            success: function(response) {
                if (response.status === 'success') {
                    quantityInput.val(response.quantity);
                    $("#subtotal").text(response.subtotal);
                    window.location.reload();
                } else {
                    Swal.fire({
                        icon: 'error',
                        title: 'Oops...',
                        text: response.message,
                    });

                }
            },
            error: function() {
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'Something went wrong. Please try again later.',
                });
            }
        });
    }
</script>

{% endblock content %}
